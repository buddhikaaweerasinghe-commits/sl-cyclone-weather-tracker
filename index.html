<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SL-MET Live Sector Watch | ABIO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+Sinhala:wght@400;700&display=swap');
        
        body { background-color: #050505; font-family: 'Inter', sans-serif; }
        .sinhala { font-family: 'Noto Sans Sinhala', sans-serif; }
        
        #map { 
            height: 600px; 
            width: 100%; 
            border-radius: 12px; 
            background: #1a1a1a;
            border: 1px solid #333;
        }
        
        .pulse-alert { animation: pulse-alert 2s infinite; }
        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="text-zinc-100 antialiased p-2 md:p-6">

    <!-- Header -->
    <header class="max-w-7xl mx-auto mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-zinc-900/50 p-6 rounded-xl border border-zinc-800 backdrop-blur-md">
        <div>
            <div class="flex items-center gap-3">
                <div class="bg-red-600 text-white px-2 py-0.5 rounded font-black text-[10px] uppercase animate-pulse tracking-tighter text-center">Live<br>Sector</div>
                <h1 class="text-2xl font-black tracking-tight text-white italic leading-none">SL-MET <span class="text-yellow-500">MONITOR</span></h1>
            </div>
            <p class="text-zinc-500 text-[10px] uppercase tracking-[0.3em] mt-2 font-bold">ABIO • Jan 06, 2026 Situation</p>
        </div>
        <div class="flex flex-wrap items-center gap-6">
            <div class="bg-black/40 px-4 py-2 rounded-lg border border-zinc-800">
                <span class="text-[9px] text-zinc-500 block uppercase font-bold tracking-widest mb-1">Next Data Update In</span>
                <span id="next-update-timer" class="text-lg font-mono text-yellow-500 font-bold tracking-tighter">00:00:00</span>
            </div>
            <div class="text-right hidden sm:block">
                <span class="text-[10px] text-zinc-500 block uppercase font-bold tracking-widest">Global Clock (UTC)</span>
                <span id="utc-clock" class="text-sm font-mono text-white italic font-bold">00:00:00</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Left Stats -->
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800 shadow-xl relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-[10px] text-yellow-500 font-bold uppercase tracking-[0.2em]">Primary Incident</h2>
                    <span id="last-updated-stamp" class="text-[9px] font-mono text-zinc-500 bg-black px-2 py-1 rounded">STAMP: JAN 06 12:00Z</span>
                </div>
                
                <h3 id="storm-name" class="text-4xl font-black text-white uppercase italic mb-1">---</h3>
                <div id="storm-date" class="text-[10px] text-zinc-500 font-bold mb-6 border-b border-zinc-800 pb-2 italic">Observation: ----</div>

                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div class="bg-black p-4 rounded-lg border border-zinc-800">
                        <span class="text-[9px] text-zinc-500 uppercase block font-bold mb-1">Max Winds</span>
                        <span id="storm-wind" class="text-2xl font-black text-emerald-400">--</span>
                        <span class="text-[10px] text-zinc-600 font-bold ml-1 italic">KTS</span>
                    </div>
                    <div class="bg-black p-4 rounded-lg border border-zinc-800">
                        <span class="text-[9px] text-zinc-500 uppercase block font-bold mb-1">Central Press</span>
                        <span id="storm-pressure" class="text-2xl font-black text-cyan-400">----</span>
                        <span class="text-[10px] text-zinc-600 font-bold ml-1 italic">HPA</span>
                    </div>
                    <div class="col-span-2 bg-zinc-950 p-4 rounded-lg border border-zinc-800">
                        <div class="flex justify-between items-center">
                            <span class="text-[9px] text-zinc-500 uppercase font-bold">Dist. to Colombo</span>
                            <span class="text-[8px] text-red-500 font-black animate-pulse">! CRITICAL ALERT</span>
                        </div>
                        <span id="storm-dist" class="text-3xl font-black text-white">----</span>
                        <span class="text-[10px] text-zinc-500 font-bold uppercase ml-2 italic underline underline-offset-4">Kilometers</span>
                    </div>
                </div>

                <div class="p-4 bg-zinc-800/30 rounded border border-zinc-700">
                    <h4 class="text-[10px] text-yellow-500 font-bold uppercase mb-2">Technical Impact Analysis</h4>
                    <p id="storm-impact" class="text-xs text-zinc-300 leading-relaxed italic">Monitoring regional circulation. System tracking west-northwest.</p>
                </div>
            </div>

            <!-- List Feed -->
            <div class="bg-zinc-900/50 p-6 rounded-xl border border-zinc-800">
                <h2 class="text-[10px] text-zinc-500 font-bold uppercase tracking-[0.3em] mb-4">Active Incident List</h2>
                <div id="system-feed" class="space-y-3 max-h-[250px] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </div>

        <!-- Map & Sinhala Advisory -->
        <div class="lg:col-span-8 space-y-4">
            <div class="relative">
                <div id="map"></div>
                <div class="absolute top-4 right-4 z-[1000] flex flex-wrap justify-end gap-2">
                    <button onclick="toggleSpaghetti()" id="spaghetti-btn" class="bg-yellow-500/10 hover:bg-yellow-500 text-yellow-500 hover:text-black px-3 py-1.5 rounded border border-yellow-500/30 text-[10px] font-black transition-all tracking-widest uppercase">Possible Paths</button>
                    <button onclick="changeMap('topo')" class="bg-black/90 hover:bg-zinc-700 text-white px-3 py-1.5 rounded border border-zinc-700 text-[10px] font-black transition-all tracking-widest">SATELLITE</button>
                    <button onclick="changeMap('standard')" class="bg-black/90 hover:bg-zinc-700 text-white px-3 py-1.5 rounded border border-zinc-700 text-[10px] font-black transition-all tracking-widest">TERRAIN</button>
                </div>
                <!-- Model Legend Overlay -->
                <div id="model-legend" class="hidden absolute bottom-4 left-4 z-[1000] bg-black/80 p-3 rounded-lg border border-zinc-800 backdrop-blur-sm">
                    <p class="text-[9px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Mathematical Models</p>
                    <p class="text-[7px] text-zinc-400 mb-2 uppercase">Ensemble Forecast Tracks</p>
                    <div class="flex gap-4">
                        <div class="flex items-center gap-2"><span class="w-3 h-0.5 bg-blue-500"></span><span class="text-[9px] font-bold">GFS</span></div>
                        <div class="flex items-center gap-2"><span class="w-3 h-0.5 bg-green-500"></span><span class="text-[9px] font-bold">ECMWF</span></div>
                        <div class="flex items-center gap-2"><span class="w-3 h-0.5 bg-red-500"></span><span class="text-[9px] font-bold">HWRF</span></div>
                        <div class="flex items-center gap-2"><span class="w-3 h-0.5 bg-yellow-500"></span><span class="text-[9px] font-bold">UKMET</span></div>
                    </div>
                </div>
            </div>

            <!-- Sinhala Advisory Section -->
            <div class="bg-zinc-900/80 p-6 rounded-xl border border-zinc-800 shadow-2xl backdrop-blur-md">
                <div class="flex items-center gap-4 mb-4 border-b border-zinc-800 pb-3">
                    <div class="bg-yellow-500 text-black px-3 py-1 rounded font-black text-xs uppercase italic">Alert / අනතුරු ඇඟවීම</div>
                    <h2 class="sinhala text-lg font-bold text-white tracking-tight leading-none">විශේෂ කාලගුණ නිවේදනය - ශ්‍රී ලංකා කලාපය</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="sinhala">
                        <p class="text-[10px] text-zinc-500 uppercase font-bold mb-2 tracking-widest">Fishermen Advisory / ධීවර ප්‍රජාවට උපදෙස්</p>
                        <p class="text-sm text-zinc-300 leading-relaxed">
                            දිවයිනට ගිනිකොණ දෙසින් පවතින අඩු පීඩන කලාපය (Invest 90B) හේතුවෙන් දිවයින වටා වන මුහුදු ප්‍රදේශවල සුළඟේ වේගය පැ.කි.මී 50-60 දක්වා ඉහළ යා හැක. මුහුදු ප්‍රදේශ ඉතා රළු විය හැකි බැවින් ධීවර සහ නාවික ප්‍රජාව මේ පිළිබඳ අවධානයෙන් පසුවිය යුතුය.
                        </p>
                    </div>
                    <div class="sinhala border-l border-zinc-800 pl-0 md:pl-6">
                        <p class="text-[10px] text-zinc-500 uppercase font-bold mb-2 tracking-widest">Public Safety / මහජන ආරක්ෂාව</p>
                        <p class="text-sm text-zinc-300 leading-relaxed">
                            විශේෂයෙන් උතුරු, නැගෙනහිර සහ දකුණු පළාත්වල තද වැසි සහ තාවකාලික තද සුළං ඇතිවිය හැක. අකුණු අනතුරු අවම කර ගැනීමට අවශ්‍ය පියවර ගන්නා ලෙස මහජනතාවගෙන් ඉල්ලා සිටිනු ලැබේ.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const COLOMBO_REF = [6.9271, 79.8612];
        let showSpaghetti = false;
        let spaghettiLayers = [];
        
        // Latest Real Info: Jan 06, 2026
        const activeSystems = [
            {
                id: "INVEST 90B",
                name: "LOW PRESSURE AREA",
                lat: 5.2,
                lng: 88.1,
                wind: 25,
                pressure: 1007,
                date: "2026-01-06 12:00 UTC",
                status: "Developing Invest",
                color: "#eab308",
                impact: "Broad low-level circulation. Tracking West-Northwest toward SL. Models suggest gradual consolidation.",
                alert: "WATCH",
                spaghetti: [
                    { model: 'GFS', color: '#3b82f6', path: [[5.2, 88.1], [6.0, 86.0], [7.2, 83.5], [8.5, 81.2], [9.8, 80.0]] },
                    { model: 'GFS', color: '#3b82f6', path: [[5.2, 88.1], [5.8, 85.5], [6.5, 82.0], [7.0, 79.5]] },
                    { model: 'ECMWF', color: '#22c55e', path: [[5.2, 88.1], [5.5, 85.0], [6.2, 81.5], [6.8, 78.5]] },
                    { model: 'ECMWF', color: '#22c55e', path: [[5.2, 88.1], [6.5, 87.0], [8.0, 86.5], [10.5, 86.0]] }, 
                    { model: 'HWRF', color: '#ef4444', path: [[5.2, 88.1], [5.9, 84.0], [7.5, 81.8]] },
                    { model: 'UKMET', color: '#eab308', path: [[5.2, 88.1], [5.3, 85.0], [5.5, 82.0], [5.8, 80.0]] }
                ]
            },
            {
                id: "CYC-JENNA",
                name: "CYC JENNA (S.I.O)",
                lat: -16.3,
                lng: 94.1,
                wind: 90,
                pressure: 968,
                date: "2026-01-06 12:00 UTC",
                status: "Severe Cyclone",
                color: "#dc2626",
                impact: "Intense system south of Cocos Islands. Tracking SW at 15km/h. Rapid weakening expected in 48h.",
                alert: "MONITOR",
                spaghetti: [
                    { model: 'GEFS', color: '#3b82f6', path: [[-16.3, 94.1], [-18.5, 92.0], [-21.0, 90.5]] },
                    { model: 'GEFS', color: '#3b82f6', path: [[-16.3, 94.1], [-17.5, 93.0], [-19.0, 91.5]] }
                ]
            }
        ];

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
        }

        const map = L.map('map', { zoomControl: false }).setView([7.8731, 80.7718], 5);

        const tiles = {
            topo: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Esri Satellite' }),
            standard: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: 'OpenTopo' })
        };
        tiles.topo.addTo(map);

        function changeMap(key) {
            Object.values(tiles).forEach(t => map.removeLayer(t));
            tiles[key].addTo(map);
        }

        L.circleMarker(COLOMBO_REF, { radius: 6, fillColor: "#eab308", color: "#fff", weight: 2, fillOpacity: 1 }).addTo(map).bindTooltip("<b class='font-black tracking-tighter'>COLOMBO (REF)</b>", { permanent: true, direction: 'top' });

        activeSystems.forEach(sys => {
            const marker = L.circleMarker([sys.lat, sys.lng], {
                radius: 12,
                fillColor: sys.color,
                color: "#fff",
                weight: 1,
                fillOpacity: 0.9,
                className: sys.wind > 30 ? 'pulse-alert' : ''
            }).addTo(map);

            marker.bindTooltip(`<div class='bg-black p-1 text-[10px] font-black' style='color:${sys.color}'>${sys.id}</div>`, { permanent: true, direction: 'bottom' });
            marker.on('click', () => updateDisplay(sys));
        });

        function toggleSpaghetti() {
            showSpaghetti = !showSpaghetti;
            const btn = document.getElementById('spaghetti-btn');
            const legend = document.getElementById('model-legend');
            
            if (showSpaghetti) {
                btn.classList.add('bg-yellow-500', 'text-black');
                legend.classList.remove('hidden');
                drawSpaghetti();
            } else {
                btn.classList.remove('bg-yellow-500', 'text-black');
                legend.classList.add('hidden');
                clearSpaghetti();
            }
        }

        function drawSpaghetti() {
            clearSpaghetti();
            activeSystems.forEach(sys => {
                if (sys.spaghetti) {
                    sys.spaghetti.forEach(member => {
                        const line = L.polyline(member.path, {
                            color: member.color,
                            weight: 1.5,
                            opacity: 0.6,
                            dashArray: '5, 5'
                        }).addTo(map);
                        spaghettiLayers.push(line);
                    });
                }
            });
        }

        function clearSpaghetti() {
            spaghettiLayers.forEach(l => map.removeLayer(l));
            spaghettiLayers = [];
        }

        function updateDisplay(sys) {
            const dist = calculateDistance(sys.lat, sys.lng, COLOMBO_REF[0], COLOMBO_REF[1]);
            document.getElementById('storm-name').innerText = sys.name;
            document.getElementById('storm-date').innerText = `STAMP: ${sys.date}`;
            document.getElementById('storm-wind').innerText = sys.wind;
            document.getElementById('storm-pressure').innerText = sys.pressure;
            document.getElementById('storm-dist').innerText = dist;
            document.getElementById('storm-impact').innerText = sys.impact;
            document.getElementById('last-updated-stamp').innerText = `DATA: ${sys.date.split(' ')[1]}`;
            if(showSpaghetti) drawSpaghetti(); 
        }

        function populateFeed() {
            const container = document.getElementById('system-feed');
            container.innerHTML = '';
            activeSystems.forEach(sys => {
                const dist = calculateDistance(sys.lat, sys.lng, COLOMBO_REF[0], COLOMBO_REF[1]);
                const div = document.createElement('div');
                div.className = "bg-black/60 p-4 rounded border border-zinc-800 cursor-pointer hover:border-yellow-500 transition-all";
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-white font-black text-xs italic tracking-tighter">${sys.id}</span>
                        <span class="text-[8px] font-bold px-1.5 py-0.5 rounded bg-zinc-900 border border-zinc-800 text-zinc-500 uppercase">${sys.status}</span>
                    </div>
                    <div class="flex justify-between text-[10px] mt-2 font-mono">
                        <span class="text-zinc-500">DIST: <b class="text-white">${dist}KM</b></span>
                        <span class="text-zinc-500">PRESS: <b class="text-cyan-400">${sys.pressure}HPA</b></span>
                    </div>
                `;
                div.onclick = () => { updateDisplay(sys); map.flyTo([sys.lat, sys.lng], 6); };
                container.appendChild(div);
            });
        }

        function updateTimers() {
            const now = new Date();
            document.getElementById('utc-clock').innerText = now.toLocaleTimeString('en-GB', { timeZone: 'UTC' }) + " UTC";
            
            const currentHour = now.getUTCHours();
            const updateHours = [0, 6, 12, 18, 24];
            const nextUpdateHour = updateHours.find(h => h > currentHour);
            
            const nextUpdate = new Date(now);
            nextUpdate.setUTCHours(nextUpdateHour, 0, 0, 0);
            
            const diff = nextUpdate - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            
            document.getElementById('next-update-timer').innerText = 
                `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        setInterval(updateTimers, 1000);
        populateFeed();
        updateDisplay(activeSystems[0]);
    </script>
</body>
</html>
